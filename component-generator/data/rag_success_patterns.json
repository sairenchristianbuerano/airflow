{
  "version": "1.0",
  "created_at": "2026-01-20T19:50:56.057866",
  "patterns": [
    {
      "id": "nemo_qa_operator_success_2026_01_20",
      "component_name": "NeMoQuestionAnsweringOperator",
      "category": "ml",
      "subcategory": "nlp",
      "framework": "nvidia_nemo",
      "component_type": "operator",
      "operator_code": "try:\n    from airflow.sdk.bases.operator import BaseOperator\nexcept ImportError:\n    from airflow.models import BaseOperator\n\nfrom airflow.exceptions import AirflowException\nfrom typing import Dict, Any, Optional, Sequence\nfrom pathlib import Path\nimport json\nimport os\nimport logging\n\nclass NeMoQuestionAnsweringOperator(BaseOperator):\n    \"\"\"\n    Execute NVIDIA NeMo Question Answering for training or inference.\n    \n    Supports extractive QA (BERT-based) and generative QA (T5/GPT-based models).\n    Handles dataset in SQuAD format for training and evaluation.\n    \n    Args:\n        mode: Operation mode - train, inference, or evaluate\n        model_type: QA model type - extractive, generative_s2s, or generative_gpt\n        pretrained_model_name: Pretrained model name from HuggingFace or NeMo\n        dataset_file: Path to dataset file in SQuAD format\n        output_dir: Output directory for results\n        **kwargs: Additional keyword arguments passed to BaseOperator\n    \"\"\"\n    \n    template_fields: Sequence[str] = ['mode', 'model_type', 'dataset_file', 'output_dir']\n    ui_color: str = \"#76b900\"",
      "metadata": {
        "component_name": "NeMoQuestionAnsweringOperator",
        "component_type": "operator",
        "category": "ml",
        "subcategory": "nlp",
        "framework": "nvidia_nemo",
        "generation_date": "2026-01-20",
        "generation_status": "success"
      },
      "success_score": 165,
      "pattern_type": "ml_operator_with_runtime_params",
      "indexed_at": "2026-01-20T19:50:56.057278"
    },
    {
      "id": "nvidia_riva_operator_success_2026_01_27",
      "component_name": "NvidiaRivaOperator",
      "category": "ml",
      "subcategory": "speech-ai",
      "framework": "nvidia_riva",
      "component_type": "operator",
      "operator_code": "from airflow.models import BaseOperator\nfrom airflow.exceptions import AirflowException\nfrom typing import Dict, Any, Optional, Sequence\nimport grpc\nimport json\nimport wave\nimport os\nfrom pathlib import Path\n\nclass NvidiaRivaOperator(BaseOperator):\n    \"\"\"\n    Operator for NVIDIA Riva conversational AI operations.\n\n    Supports speech-to-text (ASR), text-to-speech (TTS), and NLP inference\n    using NVIDIA Riva gRPC API.\n\n    :param riva_server_url: NVIDIA Riva server gRPC endpoint (e.g., localhost:50051)\n    :type riva_server_url: str\n    :param operation_type: Type of Riva operation: asr, tts, or nlp\n    :type operation_type: str\n    :param audio_file_path: Path to audio file for ASR transcription (WAV format recommended)\n    :type audio_file_path: Optional[str]\n    :param text_input: Text input for TTS or NLP operations\n    :type text_input: Optional[str]\n    :param language_code: Language code for processing (e.g., en-US)\n    :type language_code: Optional[str]\n    :param sample_rate: Audio sample rate in Hz\n    :type sample_rate: Optional[int]\n    :param output_path: Output path for TTS audio file\n    :type output_path: Optional[str]\n    :param model_name: Specific Riva model to use\n    :type model_name: Optional[str]\n    :param ssl_cert_path: Path to SSL certificate for secure connections\n    :type ssl_cert_path: Optional[str]\n    \"\"\"\n\n    template_fields: Sequence[str] = [\n        'operation_type', 'language_code', 'text_input', 'audio_file_path',\n        'output_path', 'model_name'\n    ]\n    ui_color: str = \"#76B900\"\n\n    def __init__(\n        self,\n        riva_server_url: str,\n        operation_type: str,\n        audio_file_path: Optional[str] = None,\n        text_input: Optional[str] = None,\n        language_code: Optional[str] = \"en-US\",\n        sample_rate: Optional[int] = 16000,\n        output_path: Optional[str] = None,\n        model_name: Optional[str] = None,\n        ssl_cert_path: Optional[str] = None,\n        **kwargs\n    ):\n        super().__init__(**kwargs)\n\n        if not riva_server_url:\n            raise AirflowException(\"riva_server_url is required\")\n\n        # Validate operation_type if not a template\n        valid_operations = ['asr', 'tts', 'nlp']\n        if '{{' not in str(operation_type) and operation_type not in valid_operations:\n            raise AirflowException(f\"operation_type must be one of {valid_operations}\")\n\n        # Validate sample_rate\n        if sample_rate is not None and sample_rate <= 0:\n            raise AirflowException(\"sample_rate must be a positive integer\")\n\n        self.riva_server_url = riva_server_url\n        self.operation_type = operation_type\n        self.audio_file_path = audio_file_path\n        self.text_input = text_input\n        self.language_code = language_code\n        self.sample_rate = sample_rate\n        self.output_path = output_path\n        self.model_name = model_name\n        self.ssl_cert_path = ssl_cert_path\n\n        self.log.info(f\"Initialized NvidiaRivaOperator for {operation_type} operation\")\n\n    def execute(self, context: Dict[str, Any]) -> Any:\n        self.log.info(f\"Executing NvidiaRivaOperator {self.operation_type} operation\")\n\n        # Validate template fields after rendering\n        valid_operations = ['asr', 'tts', 'nlp']\n        if self.operation_type not in valid_operations:\n            raise AirflowException(f\"operation_type must be one of {valid_operations}\")\n\n        try:\n            channel = self._create_grpc_channel()\n\n            if self.operation_type == 'asr':\n                result = self._execute_asr(channel)\n            elif self.operation_type == 'tts':\n                result = self._execute_tts(channel, context)\n            elif self.operation_type == 'nlp':\n                result = self._execute_nlp(channel)\n            else:\n                raise AirflowException(f\"Unsupported operation type: {self.operation_type}\")\n\n            channel.close()\n            self.log.info(f\"Successfully completed {self.operation_type} operation\")\n            return result\n\n        except grpc.RpcError as e:\n            self.log.error(f\"gRPC error during {self.operation_type} operation: {e}\")\n            raise AirflowException(f\"Riva gRPC error: {e}\")\n        except Exception as e:\n            self.log.error(f\"Error during {self.operation_type} operation: {e}\")\n            raise AirflowException(f\"Riva operation failed: {e}\")",
      "test_code": "# ============================================================================\n# PYTEST TEST FILE - DO NOT PLACE IN AIRFLOW DAGS FOLDER\n# ============================================================================\nimport pytest\nfrom datetime import datetime\nfrom unittest.mock import MagicMock, patch\nfrom airflow.models import DAG, TaskInstance\nfrom airflow.utils import timezone\nfrom airflow.utils.state import State\n\ntry:\n    from nvidia_riva_operator import NvidiaRivaOperator\nexcept ImportError:\n    try:\n        from custom_operators.nvidia_riva_operator import NvidiaRivaOperator\n    except ImportError:\n        raise ImportError(\n            \"Could not import NvidiaRivaOperator. \"\n            \"Ensure 'nvidia_riva_operator.py' is in the Python path.\"\n        )\n\n@pytest.fixture\ndef dag():\n    return DAG(\n        dag_id='test_dag',\n        start_date=timezone.datetime(2024, 1, 1),\n        default_args={'owner': 'airflow'}\n    )\n\nclass TestNvidiaRivaOperator:\n    def test_operator_initialization(self, dag):\n        operator = NvidiaRivaOperator(\n            task_id='test_task',\n            dag=dag,\n            riva_server_url='localhost:50051',\n            operation_type='nlp',\n            text_input='Test message for NLP analysis',\n        )\n        assert operator.task_id == 'test_task'\n        assert operator.operation_type == 'nlp'\n\n    def test_template_fields(self, dag):\n        operator = NvidiaRivaOperator(\n            task_id='test_task',\n            dag=dag,\n            riva_server_url='localhost:50051',\n            operation_type='nlp',\n            text_input='Test message',\n        )\n        assert 'operation_type' in operator.template_fields\n        assert 'text_input' in operator.template_fields\n\n    def test_ui_color(self, dag):\n        operator = NvidiaRivaOperator(\n            task_id='test_task',\n            dag=dag,\n            riva_server_url='localhost:50051',\n            operation_type='nlp',\n            text_input='Test message',\n        )\n        assert operator.ui_color == '#76B900'",
      "dag_code": "\"\"\"\nTest DAG for NvidiaRivaOperator\n\nOperator for NVIDIA Riva conversational AI - supports speech-to-text (ASR), \ntext-to-speech (TTS), and NLP inference using Riva API\n\"\"\"\n\nfrom airflow import DAG\nfrom datetime import datetime, timedelta\n\n# Import Param with Airflow 3.x compatibility\ntry:\n    from airflow.sdk import Param  # Airflow 3.x\nexcept ImportError:\n    from airflow.models.param import Param  # Airflow 2.x fallback\n\n# Fallback import paths for operator\ntry:\n    from nvidia_riva_operator import NvidiaRivaOperator\nexcept ImportError:\n    try:\n        from custom_operators.nvidia_riva_operator import NvidiaRivaOperator\n    except ImportError:\n        try:\n            from plugins.nvidia_riva_operator import NvidiaRivaOperator\n        except ImportError:\n            raise ImportError(\"Could not import NvidiaRivaOperator\")\n\ndefault_args = {\n    'owner': 'airflow',\n    'depends_on_past': False,\n    'start_date': datetime(2024, 1, 1),\n    'email_on_failure': False,\n    'email_on_retry': False,\n    'retries': 1,\n    'retry_delay': timedelta(minutes=5),\n}\n\nwith DAG(\n    dag_id='test_nvidia_riva_operator',\n    default_args=default_args,\n    description='Test DAG for NVIDIA Riva Speech AI Operator',\n    schedule=None,\n    catchup=False,\n    tags=['test', 'custom-component', 'operator', 'nvidia', 'riva', 'speech-ai'],\n    params={\n        'operation_type': Param(\n            default='nlp',\n            type='string',\n            description='Select the Riva operation type (nlp recommended for testing)',\n            enum=[\"asr\", \"tts\", \"nlp\"]\n        ),\n        'language_code': Param(\n            default='en-US',\n            type='string',\n            description='Language code for processing'\n        ),\n        'text_input': Param(\n            default='Hello, this is a test message for NVIDIA Riva NLP analysis.',\n            type='string',\n            description='Text input for NLP or TTS operations'\n        ),\n    },\n) as dag:\n\n    test_task = NvidiaRivaOperator(\n        task_id='test_nvidia_riva_operator_task',\n        riva_server_url='localhost:50051',\n        operation_type=\"{{ params.operation_type }}\",\n        language_code=\"{{ params.language_code }}\",\n        text_input=\"{{ params.text_input }}\",\n    )",
      "metadata": {
        "component_name": "NvidiaRivaOperator",
        "component_type": "operator",
        "category": "ml",
        "subcategory": "speech-ai",
        "framework": "nvidia_riva",
        "generation_date": "2026-01-27",
        "generation_status": "success",
        "generation_metrics": {
          "attempts": 1,
          "model": "claude-sonnet-4-20250514",
          "complexity_score": 27.0
        },
        "validation_results": {
          "syntax_errors": 0,
          "import_errors": 0,
          "security_issues": 0,
          "warnings": 0,
          "airflow_compliance": true
        },
        "component_features": {
          "operation_types": [
            "asr",
            "tts",
            "nlp"
          ],
          "runtime_parameters": true,
          "template_fields": true,
          "airflow_2x_compatible": true,
          "airflow_3x_compatible": true,
          "mock_execution": true,
          "type_hints": true,
          "error_handling": "comprehensive",
          "grpc_support": true,
          "ssl_support": true
        },
        "inputs": [
          {
            "name": "riva_server_url",
            "type": "str",
            "required": true,
            "description": "NVIDIA Riva server gRPC endpoint"
          },
          {
            "name": "operation_type",
            "type": "str",
            "required": true,
            "template_field": true,
            "enum": ["asr", "tts", "nlp"]
          },
          {
            "name": "audio_file_path",
            "type": "str",
            "required": false,
            "template_field": true
          },
          {
            "name": "text_input",
            "type": "str",
            "required": false,
            "template_field": true
          },
          {
            "name": "language_code",
            "type": "str",
            "required": false,
            "default": "en-US",
            "template_field": true
          },
          {
            "name": "sample_rate",
            "type": "int",
            "required": false,
            "default": 16000
          },
          {
            "name": "output_path",
            "type": "str",
            "required": false,
            "template_field": true
          },
          {
            "name": "model_name",
            "type": "str",
            "required": false,
            "template_field": true
          },
          {
            "name": "ssl_cert_path",
            "type": "str",
            "required": false
          }
        ],
        "runtime_params": [
          {
            "name": "operation_type",
            "type": "string",
            "enum": ["asr", "tts", "nlp"],
            "default": "nlp",
            "description": "Select the Riva operation type (nlp recommended for testing)"
          },
          {
            "name": "language_code",
            "type": "string",
            "default": "en-US",
            "description": "Language code for processing"
          },
          {
            "name": "text_input",
            "type": "string",
            "default": "Hello, this is a test message for NVIDIA Riva NLP analysis.",
            "description": "Text input for NLP or TTS operations"
          }
        ],
        "dependencies": [
          "apache-airflow>=2.0.0",
          "grpcio>=1.50.0",
          "protobuf>=4.0.0"
        ],
        "success_factors": [
          "Smart default selection (nlp instead of asr to avoid file requirements)",
          "Comprehensive runtime parameters including text_input",
          "Fallback import paths for operator in test DAG",
          "Airflow 3.x Param import compatibility (try/except pattern)",
          "Clear separation of test files (pytest warnings in header)",
          "gRPC connection with SSL support",
          "Mode-based execution (ASR, TTS, NLP)",
          "Mock execution for testing without real Riva server"
        ],
        "issues_encountered": [
          {
            "issue": "Default operation_type 'asr' required audio files",
            "resolution": "Changed default to 'nlp' which only requires text_input",
            "result": "Test DAG works out-of-the-box without file dependencies"
          },
          {
            "issue": "Airflow 3.x deprecated airflow.models.param.Param",
            "resolution": "Added try/except to use airflow.sdk.Param for Airflow 3.x",
            "result": "Compatible with both Airflow 2.x and 3.x"
          },
          {
            "issue": "pytest test file placed in dags folder caused import errors",
            "resolution": "Added prominent header warning that test files should not be in dags/",
            "result": "Clear separation of test files"
          },
          {
            "issue": "Operator import failed in test DAG",
            "resolution": "Added fallback import paths (same folder, custom_operators/, plugins/)",
            "result": "Flexible deployment options"
          }
        ],
        "testing_results": {
          "dag_appeared_in_ui": true,
          "import_errors": 0,
          "execution_success": {
            "nlp_mode": true,
            "tts_mode": "requires_output_path",
            "asr_mode": "requires_audio_file"
          },
          "runtime_params_functional": true,
          "airflow_3x_tested": true
        },
        "recommended_use_cases": [
          "Speech-to-Text transcription pipelines",
          "Text-to-Speech synthesis workflows",
          "NLP analysis and entity extraction",
          "Conversational AI applications",
          "Voice-enabled data pipelines",
          "Multi-language speech processing"
        ],
        "tags": [
          "ml",
          "speech-ai",
          "nvidia",
          "riva",
          "asr",
          "tts",
          "nlp",
          "grpc",
          "conversational-ai",
          "successful-generation",
          "first-attempt-success",
          "airflow-3x-compatible"
        ],
        "rag_indexing": {
          "searchable_text": "NVIDIA Riva Speech AI operator ML speech-to-text ASR text-to-speech TTS NLP inference gRPC conversational AI voice transcription runtime parameters Airflow operator",
          "similarity_keywords": [
            "machine learning",
            "speech recognition",
            "speech synthesis",
            "natural language processing",
            "voice transcription",
            "audio processing",
            "gRPC",
            "NVIDIA",
            "conversational AI"
          ],
          "pattern_category": "ml_operator_with_runtime_params"
        }
      },
      "embedding_text": "Component: NvidiaRivaOperator\nType: operator\nCategory: ml / speech-ai\nFramework: nvidia_riva\nNVIDIA Riva Speech AI operator ML speech-to-text ASR text-to-speech TTS NLP inference gRPC conversational AI voice transcription runtime parameters Airflow operator\nFeatures:\noperation types (asr, tts, nlp) | runtime parameters | template fields | airflow 2x compatible | airflow 3x compatible | mock execution | type hints | error handling | grpc support | ssl support\nSuccess Factors:\nSmart default selection (nlp) | Comprehensive runtime parameters | Fallback import paths | Airflow 3.x Param compatibility | Mock execution for testing | gRPC with SSL support\nInputs:\nriva_server_url | operation_type | audio_file_path | text_input | language_code | sample_rate | output_path | model_name | ssl_cert_path\nRuntime Parameters:\noperation_type | language_code | text_input\nCode Preview:\nfrom airflow.models import BaseOperator\nfrom airflow.exceptions import AirflowException\nfrom typing import Dict, Any, Optional, Sequence\nimport grpc\nimport json\nimport wave\nimport os\nfrom pathlib import Path\n\nclass NvidiaRivaOperator(BaseOperator):\n    template_fields: Sequence[str] = [\n        'operation_type', 'language_code', 'text_input', 'audio_file_path',\n        'output_path', 'model_name'\n    ]\n    ui_color: str = \"#76B900\"",
      "success_score": 175,
      "relevance_keywords": [
        "machine learning",
        "speech recognition",
        "speech synthesis",
        "natural language processing",
        "voice transcription",
        "audio processing",
        "gRPC",
        "NVIDIA",
        "conversational AI",
        "ASR",
        "TTS",
        "NLP"
      ],
      "pattern_type": "ml_operator_with_runtime_params",
      "indexed_at": "2026-01-27T00:00:00.000000",
      "code_patterns": {
        "__init__": "def __init__(\n        self,\n        riva_server_url: str,\n        operation_type: str,\n        audio_file_path: Optional[str] = None,\n        text_input: Optional[str] = None,\n        language_code: Optional[str] = \"en-US\",\n        sample_rate: Optional[int] = 16000,\n        output_path: Optional[str] = None,\n        model_name: Optional[str] = None,\n        ssl_cert_path: Optional[str] = None,\n        **kwargs\n    ):\n        super().__init__(**kwargs)\n\n        if not riva_server_url:\n            raise AirflowException(\"riva_server_url is required\")\n\n        # Validate operation_type if not a template\n        valid_operations = ['asr', 'tts', 'nlp']\n        if '{{' not in str(operation_type) and operation_type not in valid_operations:\n            raise AirflowException(f\"operation_type must be one of {valid_operations}\")\n\n        # Validate sample_rate\n        if sample_rate is not None and sample_rate <= 0:\n            raise AirflowException(\"sample_rate must be a positive integer\")\n\n        self.riva_server_url = riva_server_url\n        self.operation_type = operation_type\n        self.audio_file_path = audio_file_path\n        self.text_input = text_input\n        self.language_code = language_code\n        self.sample_rate = sample_rate\n        self.output_path = output_path\n        self.model_name = model_name\n        self.ssl_cert_path = ssl_cert_path\n\n        self.log.info(f\"Initialized NvidiaRivaOperator for {operation_type} operation\")",
        "execute": "def execute(self, context: Dict[str, Any]) -> Any:\n        self.log.info(f\"Executing NvidiaRivaOperator {self.operation_type} operation\")\n\n        # Validate template fields after rendering\n        valid_operations = ['asr', 'tts', 'nlp']\n        if self.operation_type not in valid_operations:\n            raise AirflowException(f\"operation_type must be one of {valid_operations}\")\n\n        try:\n            channel = self._create_grpc_channel()\n\n            if self.operation_type == 'asr':\n                result = self._execute_asr(channel)\n            elif self.operation_type == 'tts':\n                result = self._execute_tts(channel, context)\n            elif self.operation_type == 'nlp':\n                result = self._execute_nlp(channel)\n            else:\n                raise AirflowException(f\"Unsupported operation type: {self.operation_type}\")\n\n            channel.close()\n            self.log.info(f\"Successfully completed {self.operation_type} operation\")\n            return result\n\n        except grpc.RpcError as e:\n            self.log.error(f\"gRPC error during {self.operation_type} operation: {e}\")\n            raise AirflowException(f\"Riva gRPC error: {e}\")\n        except Exception as e:\n            self.log.error(f\"Error during {self.operation_type} operation: {e}\")\n            raise AirflowException(f\"Riva operation failed: {e}\")",
        "imports": "from airflow.models import BaseOperator\nfrom airflow.exceptions import AirflowException\nfrom typing import Dict, Any, Optional, Sequence\nimport grpc\nimport json\nimport wave\nimport os\nfrom pathlib import Path",
        "class_definition": "class NvidiaRivaOperator(BaseOperator):",
        "template_fields": "template_fields: Sequence[str] = [\n        'operation_type', 'language_code', 'text_input', 'audio_file_path',\n        'output_path', 'model_name'\n    ]",
        "grpc_channel": "def _create_grpc_channel(self) -> grpc.Channel:\n        try:\n            if self.ssl_cert_path and Path(self.ssl_cert_path).exists():\n                with open(self.ssl_cert_path, 'rb') as f:\n                    credentials = grpc.ssl_channel_credentials(f.read())\n                channel = grpc.secure_channel(self.riva_server_url, credentials)\n            else:\n                channel = grpc.insecure_channel(self.riva_server_url)\n\n            grpc.channel_ready_future(channel).result(timeout=10)\n            self.log.info(f\"Successfully connected to Riva server: {self.riva_server_url}\")\n            return channel\n\n        except grpc.FutureTimeoutError:\n            raise AirflowException(f\"Timeout connecting to Riva server: {self.riva_server_url}\")\n        except Exception as e:\n            raise AirflowException(f\"Failed to connect to Riva server: {e}\")",
        "param_import_pattern": "# Import Param with Airflow 3.x compatibility\ntry:\n    from airflow.sdk import Param  # Airflow 3.x\nexcept ImportError:\n    from airflow.models.param import Param  # Airflow 2.x fallback",
        "operator_import_pattern": "try:\n    from nvidia_riva_operator import NvidiaRivaOperator\nexcept ImportError:\n    try:\n        from custom_operators.nvidia_riva_operator import NvidiaRivaOperator\n    except ImportError:\n        try:\n            from plugins.nvidia_riva_operator import NvidiaRivaOperator\n        except ImportError:\n            raise ImportError(\"Could not import NvidiaRivaOperator\")"
      }
    }
  ],
  "updated_at": "2026-01-27T00:00:00.000000"
}
